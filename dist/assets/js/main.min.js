function linebreak(e){var n=/\n\n/g,t=/\n/g;return e.replace(n,"<p></p>").replace(t,"<br>")}function capitalize(e){var n=/\S/;return e.replace(n,function(e){return e.toUpperCase()})}var speechLanguages=[];window.speechSynthesis.onvoiceschanged=function(){var e="";$.each(window.speechSynthesis.getVoices(),function(n,t){e=t.lang,-1==jQuery.inArray(e,speechLanguages)&&e&&speechLanguages.push(e)})};var voicePlayer=function(){var e=!1,n="es",t="¡Tengo vida propia!";this.created=function(){"speechSynthesis"in window?(this.speech=new SpeechSynthesisUtterance,this.ready()):console.error("Your browser does not support the Web Speech API")},this.ready=function(){this.textChanged(),this.accentChanged(),e&&this.speak()},this.accentChanged=function(){this.speech.lang=n},this.textChanged=function(){this.speech.text=t},this.accentChange=function(e){n=e,this.accentChanged()},this.textChange=function(e){t=e,this.textChanged()},this.speak=function(){window.speechSynthesis.speak(this.speech)},this.cancel=function(){window.speechSynthesis.cancel()},this.pause=function(){window.speechSynthesis.pause()},this.resume=function(){window.speechSynthesis.resume()}};if(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition){var recognition=new webkitSpeechRecognition,player=new voicePlayer,final_transcript="",playerAccent="";recognition.continuous=!0,recognition.lang="es-AR",recognition.interimResults=!1,$("#language-selector").on("input",function(){playerAccent=$(this).val(),$("#recognition-button").removeClass("visuallyhidden")}),document.querySelector("#recognition-form").addEventListener("submit",function(e){e.preventDefault(),recognition.start(),$("html, body").animate({scrollTop:$(".permissions-section").offset().top},900)}),recognition.onstart=function(){player.created(),$("html, body").animate({scrollTop:$(".recognition-section").offset().top},900);for(var e=0;e<speechLanguages.length;e++)speechLanguages[e].substr(0,2)==playerAccent&&(playerAccent=speechLanguages[e]);player.accentChange(playerAccent),console.log("¡Comenzo!")},recognition.onerror=function(e){console.log("Error: "+e.error)},recognition.onend=function(){console.log("¡Termino!")},recognition.onresult=function(e){var n="";if("undefined"==typeof e.results)return recognition.onend=null,void recognition.stop();for(var t=e.resultIndex;t<e.results.length;++t)e.results[t].isFinal?final_transcript+=e.results[t][0].transcript:n+=e.results[t][0].transcript;final_transcript=capitalize(final_transcript);{var i=linebreak(final_transcript);linebreak(n)}$.getJSON("https://translate.yandex.net/api/v1.5/tr.json/translate?key=trnsl.1.1.20141228T005918Z.08453a5c73bdadd6.abd6c153aa5e7d9bc8327b4c77f373661193ee7d&lang=es-"+playerAccent.substr(0,2)+"&text="+encodeURI(i),function(e){var n=e.text[0];player.textChange(n),player.speak(),document.getElementById("recognition-text-b").textContent=n}),document.getElementById("recognition-text-a").textContent=i}}else console.error("Your browser does not support the Web Speech API");